<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="libs/slickgrid2.css">
  <link rel="stylesheet" href="slick-default-theme.css">
  <link rel="stylesheet" href="examples.css">
  <script src="libs/lodash.js" defer></script>
  <script src="libs/jquery.js" defer></script>
  <script src="libs/jquery.event.drag.js" defer></script>
  <script src="libs/slickgrid2.js" defer></script>
</head>
<body>
<h2>Demonstrates:</h2>
<ul>
  <li>right-click the priority column to open a context menu</li>
</ul>
<style>
  #contextMenu {
    background: #e1efc7;
    border: 1px solid gray;
    box-shadow: 2px 2px 2px silver;
    display: block;
    min-width: 100px;
    padding: 2px;
    z-index: 99999;
  }

  #contextMenu li {
    background: url("images/arrow_right_peppermint.png") no-repeat center left;
    cursor: pointer;
    list-style: none;
    margin: 0;
    padding: 4px 4px 4px 14px;
  }

  #contextMenu li:hover {
    background-color: white;
  }
</style>
<div id="myGrid"></div>

<ul id="contextMenu" style="display:none;position:absolute">
  <strong>Set priority:</strong>
  <li data="Low">Low</li>
  <li data="Medium">Medium</li>
  <li data="High">High</li>
</ul>

<script>
const columns = [
  { id: 'title', name: 'Title', field: 'title', width: 200 },
  { id: 'priority', name: 'Priority', field: 'priority', width: 80, selectable: true, resizable: false }
]

window.onload = () => {
  const data = _.range(0, 100).map(i => ({
    title: `Task ${i}`,
    priority: 'Medium'
  }))

  const grid = new slickgrid2.SlickGrid('#myGrid', data, columns, {
    rowHeight: 30
  })

  const $contextMenu = $('#contextMenu')
  grid.onContextMenu.subscribe(function (e) {
    e.preventDefault()
    const cell = grid.getCellFromEvent(e)
    if (grid.getColumns()[cell.cell].id !== 'priority') return

    grid.setActiveCell(cell.row, cell.cell)

    $contextMenu
    .data('row', cell.row)
    .css('top', e.pageY)
    .css('left', e.pageX)
    .show()

    $('body').one('click', () => {
      $('#contextMenu').hide()
    })
  })
  $contextMenu.click(e => {
    if (!$(e.target).is('li')) return
    if (!grid.getEditorLock().commitCurrentEdit()) return
    const row = $contextMenu.data('row')
    data[row].priority = $(e.target).attr('data')
    grid.updateRow(row)
    grid.focus()
  })
}
</script>

</body>
</html>
