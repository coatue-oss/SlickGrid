<!DOCTYPE html>
<html>
<head>
  <title>SlickGrid Example 7: Events</title>
  <link rel="stylesheet" href="../dist/slickgrid2.css">
  <link rel="stylesheet" href="slick-default-theme.css">
  <link rel="stylesheet" href="examples.css">
  <style>
    #contextMenu {
      background: #e1efc7;
      border: 1px solid gray;
      box-shadow: 2px 2px 2px silver;
      display: block;
      min-width: 100px;
      padding: 2px;
      z-index: 99999;
    }

    #contextMenu li {
      background: url("images/arrow_right_peppermint.png") no-repeat center left;
      cursor: pointer;
      list-style: none;
      margin: 0;
      padding: 4px 4px 4px 14px;
    }

    #contextMenu li:hover {
      background-color: white;
    }
  </style>
</head>
<body>
<h2>Demonstrates:</h2>
<ul>
  <li>handling events from the grid</li>
  <li>right-click the priority column to open the context menu</li>
</ul>
<div id="myGrid"></div>

<ul id="contextMenu" style="display:none;position:absolute">
  <strong>Set priority:</strong>
  <li data="Low">Low</li>
  <li data="Medium">Medium</li>
  <li data="High">High</li>
</ul>

<script src="../node_modules/lodash/lodash.js"></script>
<script src="../node_modules/jquery/dist/jquery.js"></script>
<script src="../node_modules/@bcherny/jquery.threedubmedia/event.drag/jquery.event.drag.js"></script>
<script src="../dist/slickgrid2.js"></script>
<script>
const data = []
const columns = [
  { id: 'title', name: 'Title', field: 'title', width: 200, editor: slickgrid2.TextEditor }, // TODOCK: how to not make editor come up immediately
  { id: 'priority', name: 'Priority', field: 'priority', width: 80, selectable: true, resizable: false }
]

$(function () {
  for (let i = 0; i < 100; i++) {
    data.push({
      title: `Task ${i}`,
      priority: 'Medium'
    })
  }

  const grid = new slickgrid2.SlickGrid('#myGrid', data, columns, {
    asyncEditorLoading: false,
    editable: true,
    enableAddRow: false,
    enableCellNavigation: true,
    rowHeight: 30
  })

  const $contextMenu = $('#contextMenu')
  grid.onContextMenu.subscribe(function (e) {
    e.preventDefault()
    const cell = grid.getCellFromEvent(e)
    if (grid.getColumns()[cell.cell].id !== 'priority') return

    grid.setActiveCell(cell.row, cell.cell)

    $contextMenu
    .data('row', cell.row)
    .css('top', e.pageY)
    .css('left', e.pageX)
    .show()

    $('body').one('click', () => {
      $('#contextMenu').hide()
    })
  })
  $contextMenu.click(e => {
    if (!$(e.target).is('li')) return
    if (!grid.getEditorLock().commitCurrentEdit()) return
    const row = $contextMenu.data('row')
    data[row].priority = $(e.target).attr('data')
    grid.updateRow(row)
    grid.focus()
  })
})
</script>
</body>
</html>
